!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports.PeerConnector=t():e.PeerConnector=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=7)}([function(e,t,n){e.exports=n(28)},function(e,t,n){"use strict";var r,i,o,a,c,s,u,f=n(8),l=n(25),h=Function.prototype.apply,d=Function.prototype.call,p=Object.create,v=Object.defineProperty,y=Object.defineProperties,m=Object.prototype.hasOwnProperty,w={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return l(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},c={on:r=function(e,t){var n;return l(t),m.call(this,"__ee__")?n=this.__ee__:(n=w.value=p(null),v(this,"__ee__",w),w.value=null),n[e]?"object"===typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o=function(e,t){var n,r,i,o;if(l(t),!m.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"===typeof(r=n[e]))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:a=function(e){var t,n,r,i,o;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===typeof i){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)h.call(r,this,o)}else switch(arguments.length){case 1:d.call(i,this);break;case 2:d.call(i,this,arguments[1]);break;case 3:d.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];h.call(i,this,o)}}},s={on:f(r),once:f(i),off:f(o),emit:f(a)},u=y({},s),e.exports=t=function(e){return null==e?p(u):y(Object(e),s)},t.methods=c},function(e,t,n){"use strict";var r=n(26),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t,n=arguments[1];if(r(e),void 0===n)i.call(e,"__ee__")&&delete e.__ee__;else{if(!(t=i.call(e,"__ee__")&&e.__ee__))return;t[n]&&delete t[n]}}},function(e,t,n){var r=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=r.getRandomValues(new Uint8Array(e));e--;)t+="QLUint8ARdomValuesObj0h6345-79BCrypgJzHKTNYDSMkXPZ_FfG1WcqvwxEI2"[63&n[e]];return t}},function(e,t,n){"use strict";var r=n(19)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";e.exports=function(e){return void 0!==e&&null!==e}},function(e,t,n){"use strict";(function(e){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){this.name=e,this.version=t,this.os=n};t.BrowserInfo=r;var i=function(t){this.version=t,this.name="node",this.os=e.platform};t.NodeInfo=i;var o=function(){this.bot=!0,this.name="bot",this.version=null,this.os=null};t.BotInfo=o;var a=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],c=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function s(e){var t=""!==e&&a.reduce((function(t,n){var r=n[0],i=n[1];if(t)return t;var o=i.exec(e);return!!o&&[r,o]}),!1);if(!t)return null;var i=t[0],c=t[1];if("searchbot"===i)return new o;var s=c[1]&&c[1].split(/[._]/).slice(0,3);return s?s.length<3&&(s=n(s,function(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}(3-s.length))):s=[],new r(i,s.join("."),u(e))}function u(e){for(var t=0,n=c.length;t<n;t++){var r=c[t],i=r[0];if(r[1].test(e))return i}return null}function f(){return"undefined"!==typeof e&&e.version?new i(e.version.slice(1)):null}t.detect=function(e){return e?s(e):"undefined"!==typeof navigator?s(navigator.userAgent):f()},t.parseUserAgent=s,t.detectOS=u,t.getNodeVersion=f}).call(this,n(29))},function(e,t,n){e.exports=n(30)},function(e,t,n){"use strict";var r=n(5),i=n(9),o=n(13),a=n(21),c=n(22);(e.exports=function(e,t){var n,i,s,u,f;return arguments.length<2||"string"!==typeof e?(u=t,t=e,e=null):u=arguments[2],r(e)?(n=c.call(e,"c"),i=c.call(e,"e"),s=c.call(e,"w")):(n=s=!0,i=!1),f={value:t,configurable:n,enumerable:i,writable:s},u?o(a(u),f):f}).gs=function(e,t,n){var s,u,f,l;return"string"!==typeof e?(f=n,n=t,t=e,e=null):f=arguments[3],r(t)?i(t)?r(n)?i(n)||(f=n,n=void 0):n=void 0:(f=t,t=n=void 0):t=void 0,r(e)?(s=c.call(e,"c"),u=c.call(e,"e")):(s=!0,u=!1),l={get:t,set:n,configurable:s,enumerable:u},f?o(a(f),l):l}},function(e,t,n){"use strict";var r=n(10),i=/^\s*class[\s{/}]/,o=Function.prototype.toString;e.exports=function(e){return!!r(e)&&!i.test(o.call(e))}},function(e,t,n){"use strict";var r=n(11);e.exports=function(e){if("function"!==typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!==typeof e.length)return!1;if("function"!==typeof e.call)return!1;if("function"!==typeof e.apply)return!1}catch(t){return!1}return!r(e)}},function(e,t,n){"use strict";var r=n(12);e.exports=function(e){if(!r(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,n){"use strict";var r=n(5),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!r(e)&&hasOwnProperty.call(i,typeof e)}},function(e,t,n){"use strict";e.exports=n(14)()?Object.assign:n(15)},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"===typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=n(16),i=n(20),o=Math.max;e.exports=function(e,t){var n,a,c,s=o(arguments.length,2);for(e=Object(i(e)),c=function(r){try{e[r]=t[r]}catch(i){n||(n=i)}},a=1;a<s;++a)t=arguments[a],r(t).forEach(c);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(17)()?Object.keys:n(18)},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(4),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(4);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";var r=n(4),i=Array.prototype.forEach,o=Object.create,a=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=o(null);return i.call(arguments,(function(e){r(e)&&a(Object(e),t)})),t}},function(e,t,n){"use strict";e.exports=n(23)()?String.prototype.contains:n(24)},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"===typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";e.exports=function(e){if("function"!==typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";var r=n(27);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},function(e,t,n){"use strict";var r=n(4),i={function:!0,object:!0};e.exports=function(e){return r(e)&&i[typeof e]||!1}},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return O()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=g(a,n);if(c){if(c===u)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var f=s(e,t,n);if("normal"===f.type){if(r=n.done?"completed":"suspendedYield",f.arg===u)continue;return{value:f.arg,done:n.done}}"throw"===f.type&&(r="completed",n.method="throw",n.arg=f.arg)}}}(e,n,a),o}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}e.wrap=c;var u={};function f(){}function l(){}function h(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(x([])));v&&v!==t&&n.call(v,i)&&(d=v);var y=h.prototype=f.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,a){var c=s(e[r],e,i);if("throw"!==c.type){var u=c.arg,f=u.value;return f&&"object"===typeof f&&n.call(f,"__await")?Promise.resolve(f.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(f).then((function(e){u.value=e,o(u)}),(function(e){return t("throw",e,o,a)}))}a(c.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function g(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,g(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function x(e){if(e){var t=e[i];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return l.prototype=y.constructor=h,h.constructor=l,h[a]=l.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(w.prototype),w.prototype[o]=function(){return this},e.AsyncIterator=w,e.async=function(t,n,r,i){var o=new w(c(t,n,r,i));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(y),y[a]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;b(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"===typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,u=[],f=!1,l=-1;function h(){f&&s&&(f=!1,s.length?u=s.concat(u):l=-1,u.length&&d())}function d(){if(!f){var e=c(h);f=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s&&s[l].run();l=-1,t=u.length}s=null,f=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||f||c(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),o=n(2),a=n.n(o),c=n(3),s=n.n(c);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.stream,r=void 0!==n&&n,o=t.config,a=t.channel,c=void 0===a||a,f=t.channelName,l=void 0===f?s()(20):f,h=t.channelConfig,d=void 0===h?{}:h;u(this,e),this.stream=r,this.peers=new Map,this.config=o,this.channel=c,this.channelName=l,this.channelConfig=d,this._emitter=new i.a}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){this._emitter.on(e,t)}},{key:"once",value:function(e,t){this._emitter.once(e,t)}},{key:"off",value:function(e,t){this._emitter.off(e,t)}},{key:"addPeer",value:function(e){var t=this;return e.once("connect",(function(){return t._emitter.emit("connect",e)})),this.peers.set(e.id,e),e}},{key:"removePeer",value:function(e){return this.peers.delete(e)}},{key:"hasPeer",value:function(e){return this.peers.has(e)}},{key:"getPeer",value:function(e){return this.peers.get(e)}},{key:"close",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.peers.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.close()}catch(o){t=!0,n=o}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.destroy()}},{key:"destroy",value:function(){a()(this._emitter)}}])&&f(t.prototype,n),r&&f(t,r),e}(),h=n(0),d=n.n(h);function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){i=!0,o=s}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,i)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){v(o,r,i,a,c,"next",e)}function c(e){v(o,r,i,a,c,"throw",e)}a(void 0)}))}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.stream,r=void 0!==n&&n,o=t.id,a=void 0===o?s()(20):o,c=t.channel,u=void 0===c||c,f=t.config,l=void 0===f?g:f;m(this,e),this.id=a,this.localStream=r,this.remoteStream=null,this.localSdp=null,this.remoteSdp=null,this._rtcPeer=new RTCPeerConnection(l),this._useDataChannel=u,this._dataChannel=null,this._emitter=new i.a,this._isConnectedPeer=!1,this._isConnectedDataChannel=!1,this._dataQueue=[],this._attachEvents()}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){this._emitter.on(e,t)}},{key:"once",value:function(e,t){this._emitter.once(e,t)}},{key:"off",value:function(e,t){this._emitter.off(e,t)}},{key:"isConnected",value:function(){return this._useDataChannel?this._isConnectedDataChannel&&this._isConnectedPeer:this._isConnectedPeer}},{key:"getSenders",value:function(){return this._rtcPeer.getSenders()}},{key:"createOfferSdp",value:function(){var e=y(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcPeer.createOffer(t);case 2:return this.localSdp=e.sent,this._rtcPeer.setLocalDescription(this.localSdp),e.abrupt("return",this.localSdp);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createAnswerSdp",value:function(){var e=y(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcPeer.createAnswer(t);case 2:return this.localSdp=e.sent,this._rtcPeer.setLocalDescription(this.localSdp),e.abrupt("return",this.localSdp);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDataChannel",value:function(e,t){this._useDataChannel&&this._rtcPeer.createDataChannel&&this._setDataChannel(this._rtcPeer.createDataChannel(e,t))}},{key:"setRemoteDescription",value:function(e){return this.remoteSdp=e,this._rtcPeer.setRemoteDescription(new RTCSessionDescription(this.remoteSdp))}},{key:"addIceCandidate",value:function(e){return this._rtcPeer.addIceCandidate(e)}},{key:"send",value:function(e){this._useDataChannel&&this._dataChannel&&"open"===this._dataChannel.readyState&&"connected"===!this._rtcPeer.iceConnectionState&&this._dataChannel.send(e)}},{key:"close",value:function(){this.closePeer(),this.closeChannel(),this.destroy()}},{key:"closePeer",value:function(){"disconnected"!==!this._rtcPeer.iceConnectionState&&this._rtcPeer.close()}},{key:"closeChannel",value:function(){this._dataChannel&&"closed"!==this._dataChannel.readyState&&this._dataChannel.close()}},{key:"destroy",value:function(){a()(this._emitter)}},{key:"_setDataChannel",value:function(e){var t=this;this._dataChannel=e,this._dataChannel.onopen=function(){t._isConnectedDataChannel=!0,t._emitConnect()},this._dataChannel.onmessage=function(e){var n=e.data;t.isConnected()?t._emitter.emit("data",n):t._dataQueue.push(n)},this._dataChannel.onerror=function(e){if(!t._emitter.hasListeners(t._emitter,"error"))throw e;t._emitter.emit("error",e)},this._dataChannel.onclose=function(){return t._emitter.emit("close","datachannel")}}},{key:"_attachEvents",value:function(){var e=this;this.localStream&&this.localStream.getTracks().forEach((function(t){e._rtcPeer.addTrack(t,e.localStream)})),this._rtcPeer.onicecandidate=function(t){var n=t.candidate;n&&e._emitter.emit("iceCandidate",n)},this._rtcPeer.ontrack=function(t){var n=t.streams;if(!e.remoteStream){var r=p(n,1)[0];e._emitter.emit("stream",e.remoteStream=r)}},this._rtcPeer.ondatachannel=function(t){var n=t.channel;return e._setDataChannel(n)},this._rtcPeer.oniceconnectionstatechange=function(){var t=e._rtcPeer.iceConnectionState;"connected"===t&&(e._isConnectedPeer=!0,e._emitConnect()),"disconnected"===t&&e._emitter.emit("close","ICE Connection"),e._emitter.emit("changeIceState",t)}}},{key:"_emitConnect",value:function(){if(this.isConnected()){this._emitter.emit("connect");var e=!0,t=!1,n=void 0;try{for(var r,i=this._dataQueue[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this._emitter.emit("data",o)}}catch(a){t=!0,n=a}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._dataQueue=[]}}}])&&w(t.prototype,n),r&&w(t,r),e}();function b(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,i)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){b(o,r,i,a,c,"next",e)}function c(e){b(o,r,i,a,c,"throw",e)}a(void 0)}))}}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k={JOIN:"join",REQUEST_CONNECT:"requestConnect",SDP:"sdp",CANDIDATE:"candidate"},E=function(){function e(t){var n=t.websocket,r=t.id,o=void 0===r?s()(20):r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=o,this._emitter=new i.a,this._ws=n,n.onmessage=this._onMessage.bind(this)}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){this._emitter.on(e,t)}},{key:"once",value:function(e,t){this._emitter.once(e,t)}},{key:"off",value:function(e,t){this._emitter.off(e,t)}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._ws.send(JSON.stringify({event:e,data:O({sender:this.id},t)}))}},{key:"autoSignal",value:function(e){var t=this;this.send(k.JOIN),this._emitter.on(k.JOIN,(function(e){var n=e.sender;t.send(k.REQUEST_CONNECT,{receiver:n})})),this._emitter.on(k.REQUEST_CONNECT,function(){var n=S(d.a.mark((function n(r){var i,o,a,c,s,u,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=r.sender,o=e.stream,a=e.config,c=e.channel,s=e.channelName,u=e.channelConfig,f=new _({id:i,stream:o,config:a,channel:c}),e.addPeer(f),f.createDataChannel(s,u),f.on("iceCandidate",(function(e){t.send(k.CANDIDATE,{receiver:f.id,candidate:e})})),n.t0=t,n.t1=k.SDP,n.t2=f.id,n.next=11,f.createOfferSdp();case 11:n.t3=n.sent,n.t4={receiver:n.t2,sdp:n.t3},n.t0.send.call(n.t0,n.t1,n.t4);case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),this._emitter.on(k.SDP,function(){var n=S(d.a.mark((function n(r){var i,o,a,c,s,u,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=r.sender,"answer"!==(o=r.sdp).type){n.next=7;break}return a=e.getPeer(i),n.next=5,a.setRemoteDescription(o);case 5:n.next=21;break;case 7:return c=e.stream,s=e.config,u=e.channel,f=new _({id:i,stream:c,config:s,channel:u}),e.addPeer(f),f.on("iceCandidate",(function(e){t.send(k.CANDIDATE,{receiver:f.id,candidate:e})})),n.next=13,f.setRemoteDescription(o);case 13:return n.t0=t,n.t1=k.SDP,n.t2=f.id,n.next=18,f.createAnswerSdp();case 18:n.t3=n.sent,n.t4={receiver:n.t2,sdp:n.t3},n.t0.send.call(n.t0,n.t1,n.t4);case 21:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),this._emitter.on(k.CANDIDATE,(function(t){var n=t.sender,r=t.candidate;e.getPeer(n).addIceCandidate(r)}))}},{key:"destroy",value:function(){a()(this._emitter)}},{key:"_onMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=JSON.parse(t),r=n.event,i=n.data;this._equalId(i)&&(this._emitter.emit(r,i),this._emitter.emit("message",{event:r,data:i}))}},{key:"_equalId",value:function(e){return!e.receiver||e.receiver===this.id}}])&&C(t.prototype,n),r&&C(t,r),e}(),j=n(6);function T(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,i)}function L(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){T(o,r,i,a,c,"next",e)}function c(e){T(o,r,i,a,c,"throw",e)}a(void 0)}))}}var D="https://chrome.google.com/webstore/detail/screen-sharing-extension/".concat("mopiaiibclcaiolndiidmkpejmcpjmcf");function N(){return A.apply(this,arguments)}function A(){return(A=L(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=Object(j.detect)().name,e.next="firefox"===e.t0?3:"chrome"===e.t0?4:15;break;case 3:return e.abrupt("return",{mediaSource:"screen"});case 4:return e.next=6,M();case 6:if(e.sent){e.next=8;break}window.location.href=D;case 8:return e.next=10,W();case 10:return e.t1=e.sent,e.t2=window.screen.width,e.t3=window.screen.height,e.t4={chromeMediaSource:"desktop",chromeMediaSourceId:e.t1,maxWidth:e.t2,maxHeight:e.t3},e.abrupt("return",{mandatory:e.t4});case 15:throw new Error("not support browser");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return new Promise((function(e){window.postMessage({type:"SCREEN_REQUEST",text:"start"},"*"),window.addEventListener("message",(function t(n){var r=n.data,i=r.type,o=r.streamId;"SCREEN_SHARE"===i&&(window.removeEventListener("message",t),e(o)),"SCREEN_CANCEL"===i&&(window.removeEventListener("message",t),e(!1))}))}))}function M(){return new Promise((function(e){var t=document.createElement("img");t.src="chrome-extension://".concat("mopiaiibclcaiolndiidmkpejmcpjmcf","/icon.png"),t.onload=function(){return e(!0)},t.onerror=function(){return e(!1)}}))}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.screen,n=e.video,r=e.audio;return t?B():navigator.mediaDevices.getUserMedia({video:n,audio:r})}function B(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):navigator.mediaDevices.getUserMedia({video:N()})}function R(e,t){return new Promise((function(n,r){var i=new WebSocket(e,t);i.onopen=function(){return n(i)},i.onerror=function(){return r(new Error("connect failed."))}}))}n.d(t,"PeerConnector",(function(){return l})),n.d(t,"Peer",(function(){return _})),n.d(t,"Signal",(function(){return E})),n.d(t,"SIGNAL_EVENT",(function(){return k})),n.d(t,"getMediaStream",(function(){return I})),n.d(t,"connectWebsocket",(function(){return R}));t.default=l}])}));